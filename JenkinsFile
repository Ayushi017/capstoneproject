pipeline {
    agent any
    
    environment {
        GITHUB_REPO = 'Ayushi017/capstoneproject'
        AWS_APP_IP = '3.86.193.231'  // Your AWS App Machine IP
        AZURE_APP_IP = '20.185.61.158'  // Your Azure VM IP
    }
    
    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        
        stage('Deploy to AWS') {
            steps {
                sh '''
                    echo "Starting deployment to AWS..."
                    scp -o StrictHostKeyChecking=no index-aws.html ubuntu@${AWS_APP_IP}:/tmp/
                    ssh -o StrictHostKeyChecking=no ubuntu@${AWS_APP_IP} "sudo mv /tmp/index-aws.html /var/www/html/ && sudo systemctl restart nginx"
                    echo "Deployment completed. Checking Nginx status..."
                    ssh -o StrictHostKeyChecking=no ubuntu@${AWS_APP_IP} "sudo systemctl status nginx"
                    echo "Nginx logs:"
                    ssh -o StrictHostKeyChecking=no ubuntu@${AWS_APP_IP} "sudo tail -n 50 /var/log/nginx/access.log"
                    ssh -o StrictHostKeyChecking=no ubuntu@${AWS_APP_IP} "sudo tail -n 50 /var/log/nginx/error.log"
                '''
            }
        }
        

        stage('Deploy to Azure') {
            steps {
                sh '''
                    scp -o StrictHostKeyChecking=no index-azure.html ubuntu@${AZURE_APP_IP}:/var/www/html/
                    ssh -o StrictHostKeyChecking=no ubuntu@${AZURE_APP_IP} "sudo systemctl restart nginx"
                '''
            }
        }
    }
    
    post {
        always {
            cleanWs()
        }
    }
} 
